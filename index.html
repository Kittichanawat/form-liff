<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 500px;
      margin: auto;
      padding: 30px;
      background: #f3f0ff;
      color: #2c2c54;
    }

    h2 {
      text-align: center;
      color: #5f27cd;
    }

    form {
      background: #ffffff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(95, 39, 205, 0.2);
    }

    label {
      display: block;
      margin-bottom: 18px;
      font-weight: 500;
    }

    label i {
      margin-right: 8px;
      color: #8e44ad;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #dcdde1;
      border-radius: 6px;
      font-size: 15px;
    }

    button {
      width: 100%;
      padding: 12px;
      background-color: #6c5ce7;
      border: none;
      color: white;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }

    button:hover {
      background-color: #7d5fff;
    }
  </style>
</head>
<body>
  <h2><i class="fa-solid fa-id-card"></i> ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô Codelabs</h2>
  <form id="form">
    <input type="hidden" id="userId">
    <input type="hidden" id="displayName">

    <label><i class="fa-solid fa-user"></i> ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:
      <input type="text" id="flname" required>
    </label>

    <label><i class="fa-solid fa-user-tag"></i> ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô:
      <input type="text" id="nname" required>
    </label>

    <label><i class="fa-solid fa-calendar-days"></i> ‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î:
      <input type="date" id="dob" required>
    </label>

    <label><i class="fa-solid fa-briefcase"></i> ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:
      <select id="position" required>
        <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á --</option>
        <option value="Project Manager">Project Manager</option>
        <option value="Quality Assurance">Quality Assurance</option>
        <option value="UX/UI Designer">UX/UI Designer</option>
        <option value="Front-end Developer">Front-end Developer</option>
        <option value="Back-end Developer">Back-end Developer</option>
        <option value="Business Analyst">Business Analyst</option>
        <option value="Tester">Tester</option>
        <option value="AI Engineer">AI Engineer</option>
        <option value="System Analyst">System Analyst</option>
        <option value="DevOps">DevOps</option>
      </select>
    </label>

    <label > <i class="fa-solid fa-envelope"></i> ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå
      <input type="email" id="email" required>
    </label>

    <label > <i class="fa-solid fa-phone"></i> ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
      <input type="tel" id="phone" pattern="[0-9]{10}" required>
    </label>

    <button type="submit"><i class="fa-solid fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </form>


  <script>
    document.getElementById("form").addEventListener("submit", async (e) => {
      e.preventDefault();
    
      const phone = document.getElementById("phone").value;
      const data = {
        userId: document.getElementById("userId").value,
        name: document.getElementById("flname").value,
        nickname: document.getElementById("nname").value,
        dob: document.getElementById("dob").value,
        position: document.getElementById("position").value,
        email: document.getElementById("email").value,
        phone: phone
      };
    
      try {
        // üëâ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏õ‡πÉ‡∏´‡πâ Webhook ‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏£‡πâ‡∏≤‡∏á OTP ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Redis)
        const res = await fetch("https://n8n-three.nn-dev.me/webhook-test/send-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
    
        const result = await res.json();
    
        if (!result.success) {
          Swal.fire("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á OTP ‡πÑ‡∏î‡πâ", result.message || "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", "error");
          return;
        }
    
        // ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏™‡∏î‡∏á Swal ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å OTP
        const { value: userOtp } = await Swal.fire({
          title: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ OTP",
          input: "text",
          inputLabel: `‡∏£‡∏´‡∏±‡∏™‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà ${phone}`,
          inputPlaceholder: "‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ 6 ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö",
          inputValidator: (value) => {
            if (!value) return "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ OTP";
          },
          showCancelButton: true
        });
    
        if (!userOtp) return;
    
        // üß™ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö OTP
        const verifyRes = await fetch("https://n8n-three.nn-dev.me/webhook-test/verify-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ phone, otp: userOtp })
        });
    
        const verifyResult = await verifyRes.json();
    
        if (!verifyResult.verified) {
          Swal.fire("OTP ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà", "error");
          return;
        }
    
        // ‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        Swal.fire("‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "OTP ‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß", "success").then(() => liff.closeWindow());
    
      } catch (err) {
        console.error(err);
        Swal.fire("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ", "error");
      }
    });
    </script>
    
</body>
</html>
